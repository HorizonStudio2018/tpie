# Copyright (c) 1994 Darren Erik Vengroff

# $Id: Makefile.in,v 1.10 1994-10-13 14:01:46 darrenv Exp $

# Makefile for TPIE test applications.

# Use gmake on this Makefile.  It relies on the default rules, and 
# Use gmake -p to see the default rules.

CXX = @CXX@

TPIEINC = ../include

TPIELIBDIR = ../lib

TPIELIB = $(TPIELIBDIR)/libtpie.a

ifdef DEBUG_APPS
LOG_APPS = 1
ASSERT_DEBUG_APPS = 1
endif

CXXFLAGS = -Wall #-v

ifdef OPTIMIZE_APPS
CXXFLAGS += -O
CFLAGS += -O
endif

ifdef PROFILE_APPS
CXXFLAGS += -pg 
CFLAGS += -pg
endif

ifdef SYM_DEBUG_APPS
CXXFLAGS += -gstabs+ 
CFLAGS += -gstabs
endif

CPPFLAGS = -I$(TPIEINC) @DEFS@

ifdef LOG_APPS
CPPFLAGS += -DTPL_LOGGING
endif

ifdef ASSERT_DEBUG_APPS
CPPFLAGS += -DDEBUG_ASSERTIONS -DDEBUG_STR -DDEBUG_CERR
endif

# The loader in OSF 1.x is flakey.  Using -lm generates an executable
# that /bin/loader refuses to load, so we just load the library
# explicitly.
#
# I've tried this on two machines, one running 1.2 and one running
# 1.3, and had the same problem.

LDLIBS =  -L$(TPIELIBDIR) -ltpie /usr/lib/libm.a #-lm

CC = gcc
CCFLAGS = $(CXXFLAGS)

# The various test applications.

APPS = test_ami_pmerge test_ami_sort test_ami_merge  # dist_sweep_test

# Sources to the test applications.

APPSRC = $(patsubst %,%.cpp,$(APPS))

# Other C++ sources for common support routines.

OTHERCXXSRC = scan_random.cpp scan_count.cpp parse_args.cpp app_config.cpp

CXXSRC=$(APPSRC) $(OTHERCXXSRC)

# C sources.

CSRC = int_cmp.c

// Translation rules:

%:%.o
	$(LINK.cc) $^ $(LOADLIBES) $(LDLIBS) -o $@
	
%:%.cpp
	$(LINK.cc) $< $(LOADLIBES) $(LDLIBS) -o $@

%.d:%.cpp
	$(SHELL) -ec '$(CXX) -M $(CPPFLAGS) $< | sed '\''s/$*.o/& $@/g'\'' > $@'

%.d:%.c
	$(SHELL) -ec '$(CC) -M $(CPPFLAGS) $< | sed '\''s/$*.o/& $@/g'\'' > $@'

# Specific dependencies, explicit and automatic.

all: $(APPS)

include $(CSRC:.c=.d)

include $(CXXSRC:.cpp=.d)


# What objects each of the apps acually need.

test_ami_pmerge: test_ami_pmerge.o scan_random.o 	\
	int_cmp.o parse_args.o app_config.o

test_ami_sort: test_ami_sort.o scan_random.o parse_args.o app_config.o

test_ami_merge: test_ami_merge.o scan_count.o parse_args.o app_config.o

dist_sweep_test: dist_sweep_test.o



.PHONY : clean all

clean:
	-rm $(CSRC:.c=.d) $(CSRC:.c=.o) $(CXXSRC:.cpp=.d)  $(CXXSRC:.cpp=.d)
	-rm $(APPS)



