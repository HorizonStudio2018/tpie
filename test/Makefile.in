# Copyright (c) 1994 Darren Erik Vengroff

# $Id: Makefile.in,v 1.4 1994-09-22 15:19:11 darrenv Exp $

# Makefile for TPIE test applications.

# Use gmake on this Makefile.  It relies on the default rules, and 
# Use gmake -p to see the default rules.

TPIEINC = ../include

TPIELIBDIR = ../lib

TPIELIB = $(TPIELIBDIR)/libtpie.a

ifdef DEBUG_APPS
LOG_APPS = 1
ASSERT_DEBUG_APPS = 1
endif

CXXFLAGS = #-Wall

ifdef OPTIMIZE_APPS
CXXFLAGS += -O
CFLAGS += -O
endif

ifdef SYM_DEBUG_APPS
CXXFLAGS += -gstabs+
endif

CPPFLAGS = -I$(TPIEINC) 

ifdef LOG_APPS
CPPFLAGS += -DTPL_LOGGING
endif

ifdef ASSERT_DEBUG_APPS
CPPFLAGS += -DDEBUG_ASSERTIONS -DDEBUG_STR -DDEBUG_CERR
endif

LDLIBS = -L$(TPIELIBDIR) -ltpie

CC = gcc
CCFLAGS = $(CXXFLAGS)

# The various test applications.

FSCAT=bte_fs_cat

MMAP_TEST = mmb_stream_test

AMI_SCAN = ami_scan

AMI_MERGE = test_ami_merge

BMS = binary_merge_sort

PM = partition_and_merge

APPS=$(PM) #$(BMS) #(AMI_SCAN) $(AMI_MERGE) $(BMS)

UP_TO_DATE = .up_to_date

$(UP_TO_DATE): $(APPS)
	touch $@

%:%.o
	$(LINK.cc) $< $(LOADLIBES) $(LDLIBS) -o $@
	
%:%.cpp
	$(LINK.cc) $< $(LOADLIBES) $(LDLIBS) -o $@

%: $(TPIEINC)$(UP_TO_DATE) $(TPIELIBDIR)$(UP_TO_DATE)

$(TPIEINC)$(UP_TO_DATE): $(TPIEINC)*
	$(MAKE) -C $(TPIEINC) $(UP_TO_DATE)

$(TPIELIBDIR)$(UP_TO_DATE): $(TPIELIBDIR)*
	$(MAKE) -C $(TPIELIBDIR) $(UP_TO_DATE)

$(BMS): $(BMS).cpp int_cmp.o
	$(LINK.cc) $^ $(LOADLIBES) $(LDLIBS) -o $@

LEDA_OPTIONS = -I../../LEDA-3.0/incl -L../../LEDA-3.0 -lL

$(PM): $(PM).cpp int_cmp.o
	$(LINK.cc) $^ $(LOADLIBES) $(LDLIBS) $(LEDA_OPTIONS) -o $@

.PHONY : clean

clean:
	-rm *.o
	-rm $(APPS)
	-rm $(UP_TO_DATE)

