# Copyright (c) 1994 Darren Erik Vengroff

# $Id: Makefile.in,v 1.8 1994-10-10 13:12:05 darrenv Exp $

# Makefile for TPIE libraries.

# Use GNU make on this Makefile.  It relies on the default rules.
# Use (GNU) "make -p" to see the default rules.

TPIEINC = ../../include

LIBRARY = libtpie.a



ifdef DEBUG_APPS
LOG_APPS = 1
ASSERT_DEBUG_APPS = 1
endif

CXXFLAGS = -Wall

ifdef OPTIMIZE_APPS
CXXFLAGS += -O
endif

ifdef PROFILE_APPS
CXXFLAGS += -p
endif

ifdef SYM_DEBUG_APPS
CXXFLAGS += -gstabs+
endif

CPPFLAGS = -I$(TPIEINC) 

ifdef LOG_APPS
CPPFLAGS += -DTPL_LOGGING
endif

ifdef ASSERT_DEBUG_APPS
CPPFLAGS += -DDEBUG_ASSERTIONS -DDEBUG_STR -DDEBUG_CERR
endif



SRC = logstream.cpp tpie_log.cpp mm_register.cpp ami_device.cpp		\
	 ami_single.cpp mm_base.cpp bte_mmb.cpp bte_stdio.cpp

OBJ = $(SRC:.cpp=.o)

LIB_COMPONENTS = $(patsubst %.cpp,$(LIBRARY)(%.o),$(SRC))

(%): %
	$(AR) $(ARFLAGS) $@ $<

%.d: %.cpp
	$(SHELL) -ec '$(CXX) -M $(CPPFLAGS) $< | sed '\''s/$*.o/& $@/g'\'' > $@'

all : $(LIBRARY)

include $(SRC:.cpp=.d)

$(LIBRARY): $(LIB_COMPONENTS)

.PHONY : clean all

clean:
	-rm *.o *.d
	-rm $(LIBRARY)
	-rm $(UP_TO_DATE)

