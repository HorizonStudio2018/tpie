# Copyright (c) 1994 Darren Erik Vengroff

# $Id: Makefile.in,v 1.4 1994-09-16 13:25:54 darrenv Exp $

# Makefile for TPIE libraries.

# Use GNU make on this Makefile.  It relies on the default rules.
# Use (GNU) "make -p" to see the default rules.

TPIEINC = ../../include

LIBRARY = libtpie.a



ifdef DEBUG_APPS
LOG_APPS = 1
ASSERT_DEBUG_APPS = 1
endif

CXXFLAGS = -Wall

ifdef OPTIMIZE_APPS
CXXFLAGS += -O
endif

ifdef SYM_DEBUG_APPS
CXXFLAGS += -gstabs+
endif

CPPFLAGS = -I$(TPIEINC) 

ifdef LOG_APPS
CPPFLAGS += -DTPL_LOGGING
endif

ifdef ASSERT_DEBUG_APPS
CPPFLAGS += -DDEBUG_ASSERTIONS -DDEBUG_STR -DDEBUG_CERR
endif


UP_TO_DATE = .up_to_date

$(UP_TO_DATE): $(LIBRARY)
	touch $@

(%): %
	$(AR) $(ARFLAGS) $@ $<

$(LIBRARY): $(LIBRARY)(logstream.o) $(LIBRARY)(tpie_log.o)	\
	    $(LIBRARY)(mm_single.o) $(LIBRARY)(ami_device.o)	\
	    $(LIBRARY)(ami_single.o) $(LIBRARY)(mm_base.o)

$(LIBRARY)(logstream.o): logstream.o

$(LIBRARY)(tpie_log.o): tpie_log.o

$(LIBRARY)(mm_base.o): mm_base.o

$(LIBRARY)(mm_single.o): mm_single.o

$(LIBRARY)(ami_device.o): ami_device.o

$(LIBRARY)(ami_single.o): ami_single.o

%.o: $(TPIEINC)$(UP_TO_DATE)

$(TPIEINC)$(UP_TO_DATE): $(TPIEINC)*
	$(MAKE) -C $(TPIEINC) $(UP_TO_DATE)

.PHONY : clean

clean:
	-rm *.o
	-rm $(LIBRARY)
	-rm $(UP_TO_DATE)





