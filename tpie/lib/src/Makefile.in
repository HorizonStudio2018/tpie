# Copyright (c) 1994 Darren Erik Vengroff

# $Id: Makefile.in,v 1.14 1994-12-16 21:13:50 darrenv Exp $

# Makefile for TPIE libraries.

# Use GNU make on this Makefile.  It relies on the default rules.
# Use (GNU) "make -p" to see the default rules.

TPIEINC = ../../include

LIBRARY = libtpie.a

RANLIB = @RANLIB@

ARFLAGS = rv

CXX = @CXX@

# Set GCXX to 1 if we are using the GNU compiler, and 0 otherwise.

GCXX = 0
ifeq ($(firstword $(CXX)),g++)
GCXX = 1
endif
ifeq ($(firstword $(CXX)),c++)
GCXX = 1
endif

# Use -fno-implicit-templates with the GNU compiler.  This is necessary 
# until it starts using a seperate pass to instantiate template functions. 

ifeq ($(GCXX),1)
override CXXFLAGS += -fno-implicit-templates
override CPPFLAGS += -DNO_IMPLICIT_TEMPLATES
endif

CXXFLAGS = -Wall

# Get the proper include path and DEFS from the configure script.
override CPPFLAGS += -I$(TPIEINC) @DEFS@

SRC =	logstream.cpp tpie_log.cpp mm_register.cpp ami_device.cpp	\
	ami_single.cpp mm_base.cpp bte_mmb.cpp bte_stdio.cpp		\
	bte_block_collection.cpp bit.cpp ami_matrix_blocks.cpp

OBJ = $(SRC:.cpp=.o)

LIB_COMPONENTS = $(patsubst %.cpp,$(LIBRARY)(%.o),$(SRC))

(%): %
	$(AR) $(ARFLAGS) $@ $<

%.d: %.cpp
	$(SHELL) -ec '$(CXX) -M $(CPPFLAGS) $< | sed '\''s/$*.o/& $@/g'\'' > $@'

all : $(LIBRARY)

include $(SRC:.cpp=.d)

$(LIBRARY): $(LIB_COMPONENTS)

.PHONY : clean all

clean:
	-rm $(SRC:.cpp=.d) $(OBJ)
	-rm $(LIBRARY)


