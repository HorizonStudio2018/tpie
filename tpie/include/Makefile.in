# Copyright (c) 1994 Darren Erik Vengroff
#
# The Makefile for the TPIE include directory.
#
# $Id: Makefile.in,v 1.6 1994-12-16 21:10:31 darrenv Exp $
#

INDENT=@INDENT@
INDENTFLAGS=@INDENTFLAGS@

CAT=cat
CP=cp

PERL=@PERL@

ETAGS=etags

AMI_FILES=ami.h ami_base.h ami_imps.h ami_scan.h ami_single.h

BTE_FILES=bte.h bte_base_stream.h bte_mmb.h bte_stdio.h

LOG_FILES=logstream.h tpie_log.h tpie_assert.h

TAG_FILES=$(AMI_FILES) $(BTE_FILES) $(LOG_FILES) 


all: ami_scan.h

# Build the header file that will actually be used by using the
# C preprocessor to expand all of the macros in the source file.

# We can either use the macro definitions directly, or expand them and
# filter the results through GNU indent.  The latter approach makes 
# them more readable for debugging purposes, but since most people don't
# have GNU indent, the configure script turns it off by default.

EXPAND_AMI_SCAN_H = @EXPAND_AMI_SCAN_H@

ifeq ($(EXPAND_AMI_SCAN_H),yes)
ami_scan.h: ami_scan_mac.cpp ami_scan_mac.h ami_scan.h.head ami_scan.h.tail
	$(CAT) ami_scan.h.head > $@
	$(CXX) -E $< | $(INDENT) $(INDENTFLAGS) - | grep -v "^#" | \
	    $(PERL) -e \
	    'while (<>) { print "\n" if /template/; print if /.+/; }' >> $@
	$(CAT) ami_scan.h.tail >> $@
else
ami_scan.h: ami_scan_mac.h ami_scan.h.head ami_scan.h.tail
	cat ami_scan.h.head ami_scan_mac.h ami_scan.h.tail > $@
endif

# Build a new tags file for emacs to use.
TAGS: $(TAG_FILES)
	$(ETAGS) $(TAG_FILES)

.PHONY : all clean

clean:
	-rm ami_scan.h



