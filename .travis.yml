language: cpp

env:
  global:
    - CTEST_OUTPUT_ON_FAILURE=1

notifications:
  email: false

# All this duplication is required :/
matrix:
  include:
# == Release ==
# Linux
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc-5
      env:
        - CMAKE_BUILD_TYPE=Release
        - _CC=gcc-5
        - _CXX=g++-5
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc-6
      env:
        - CMAKE_BUILD_TYPE=Release
        - _CC=gcc-6
        - _CXX=g++-6
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc-7
      env:
        - CMAKE_BUILD_TYPE=Release
        - _CC=gcc-7
        - _CXX=g++-7
    - os: linux
      dist: trusty
      sudo: required
      compiler: clang-3.9
      env:
        - CMAKE_BUILD_TYPE=Release
        - _CC=clang-3.9
        - _CXX=clang++-3.9
    - os: linux
      dist: trusty
      sudo: required
      compiler: clang-4.0
      env:
        - CMAKE_BUILD_TYPE=Release
        - _CC=clang-4.0
        - _CXX=clang++-4.0
    - os: linux
      dist: trusty
      sudo: required
      compiler: clang-5.0
      env:
        - CMAKE_BUILD_TYPE=Release
        - _CC=clang-5.0
        - _CXX=clang++-5.0

# OS X
    - os: osx
      compiler: clang
      sudo: false
      env:
        - CMAKE_BUILD_TYPE=Release


# == Debug ==
# Linux
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc-5
      env:
        - CMAKE_BUILD_TYPE=Debug
        - _CC=gcc-5
        - _CXX=g++-5
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc-6
      env:
        - CMAKE_BUILD_TYPE=Debug
        - _CC=gcc-6
        - _CXX=g++-6
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc-7
      env:
        - CMAKE_BUILD_TYPE=Debug
        - _CC=gcc-7
        - _CXX=g++-7
    - os: linux
      dist: trusty
      sudo: required
      compiler: clang-3.9
      env:
        - CMAKE_BUILD_TYPE=Debug
        - _CC=clang-3.9
        - _CXX=clang++-3.9
    - os: linux
      dist: trusty
      sudo: required
      compiler: clang-4.0
      env:
        - CMAKE_BUILD_TYPE=Debug
        - _CC=clang-4.0
        - _CXX=clang++-4.0
    - os: linux
      dist: trusty
      sudo: required
      compiler: clang-5.0
      env:
        - CMAKE_BUILD_TYPE=Debug
        - _CC=clang-5.0
        - _CXX=clang++-5.0

# OS X
    - os: osx
      compiler: clang
      sudo: false
      env:
        - CMAKE_BUILD_TYPE=Debug

addons:
  apt:
    sources:
      - boost-latest
      - ubuntu-toolchain-r-test
      - llvm-toolchain-trusty-3.9
      - llvm-toolchain-trusty-4.0
      - llvm-toolchain-trusty-5.0
    packages:
      - libboost-date-time1.55-dev
      - libboost-filesystem1.55-dev
      - libboost-system1.55-dev
      - libsnappy-dev

install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      brew update;
      brew install snappy;
    else
      sudo apt-get update;
      if [[ "$_CC" == "gcc-"* ]]; then
        sudo apt-get install "$_CC" "$_CXX";
      else
        if [[ "$_CC" == "clang-"* ]]; then
          sudo apt-get install "$_CC";
        fi;
        sudo apt-get install libstdc++-5-dev;
      fi;
    fi
  - if [[ -n "$_CC" ]]; then
      export CC=$_CC;
    fi
  - if [[ -n "$_CXX" ]]; then
      export CXX=$_CXX;
    fi

script:
  - $CC --version
  - $CXX --version
  - mkdir build
  - cd build
  - cmake -DCMAKE_BUILD_TYPE="$CMAKE_BUILD_TYPE" ..
  - make -j2
  - make test
